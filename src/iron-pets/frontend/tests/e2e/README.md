# Iron Pets E2E Tests - Playwright

## Quick Start

```bash
# Install dependencies
npm install

# Install Playwright browsers
npx playwright install --with-deps

# Run all E2E tests
npm run test:e2e

# Run with UI mode (recommended)
npm run test:e2e:ui

# Run in headed mode (see browser)
npm run test:e2e:headed

# Debug specific test
npm run test:e2e:debug

# View test report
npm run test:e2e:report
```

## Test Files

- **checkout-flow.spec.ts** - 41 comprehensive checkout tests across 10 scenarios
- **global-setup.ts** - Pre-test environment setup
- **global-teardown.ts** - Post-test cleanup

## Test Scenarios (10 Total)

1. **Complete Checkout Flow** - Full happy path from browse to confirmation
2. **Guest Checkout** - Checkout without account
3. **Error Handling** - Empty cart, invalid inputs, payment errors
4. **Cart Persistence** - Refresh, navigation, timeout
5. **Promo Codes** - Valid/invalid/expired codes
6. **Stock Handling** - Out of stock, quantity adjustments
7. **Free Shipping** - Threshold at $50+
8. **Payment Methods** - Stripe integration with test cards
9. **Order Confirmation** - Order numbers, summaries, emails
10. **Order Tracking** - View orders, history, tracking info

## Stripe Test Cards

```javascript
SUCCESS: '4242424242424242'           // Payment succeeds
DECLINED: '4000000000000002'          // Payment declined
EXPIRED: '4000000000000069'           // Expired card error
INSUFFICIENT_FUNDS: '4000000000009995' // Insufficient funds
```

**Expiry**: Any future date (e.g., `12/25`)
**CVC**: Any 3 digits (e.g., `123`)

## Test Data Selectors

All tests use `data-testid` attributes:

- `product-card-{name}`
- `cart-icon`, `cart-count`, `cart-total`
- `checkout-button`
- `first-name`, `last-name`, `email`, `address`, `city`, `state`, `zip-code`, `phone`
- `shipping-method-{standard|express|overnight}`
- `stripe-card-element`
- `promo-code-input`, `apply-promo-button`
- `place-order-button`
- `order-number`
- `email-confirmation-message`

## Expected Results (TDD RED Phase)

### Current Status: ‚ùå ALL TESTS FAILING

This is **EXPECTED** for TDD RED phase. Tests define behavior before implementation.

**Why tests fail:**
- Checkout components not implemented
- Cart system doesn't exist
- Stripe integration missing
- Promo codes not implemented
- Order system not built

### Next Steps (GREEN Phase)

1. Build checkout wizard components
2. Implement cart with Zustand + localStorage
3. Integrate Stripe Elements
4. Add promo code validation API
5. Build order creation system
6. Implement email notifications
7. Add order tracking
8. Run tests - they should pass!
9. Proceed to REFACTOR phase

## Configuration

**Browsers Tested:**
- Chromium (Desktop Chrome)
- Firefox (Desktop Firefox)
- WebKit (Desktop Safari)
- Mobile Chrome (Pixel 5)
- Mobile Safari (iPhone 12)
- iPad Pro

**Coverage Target:** 95%+ for checkout flow

## CI/CD Integration

```bash
# Run in CI environment
CI=true npm run test:e2e
```

Reports generated in `playwright-report/`:
- HTML report
- JSON results
- JUnit XML

## Debugging Tips

1. **Use UI Mode**: `npm run test:e2e:ui` - Best for development
2. **Headed Mode**: `npm run test:e2e:headed` - See browser actions
3. **Debug Mode**: `npm run test:e2e:debug` - Step through tests
4. **Screenshots**: Taken on failure (in `test-results/`)
5. **Videos**: Recorded on failure
6. **Traces**: Captured on first retry

## Documentation

See `/workspaces/aegis/docs/iron-pets/testing/e2e-test-plan.md` for full test plan.

---

**Generated by**: qe-test-writer subagent
**TDD Phase**: RED (Write Failing Tests)
**Framework**: Playwright v1.42+
**Total Tests**: 41
**Test Scenarios**: 10
